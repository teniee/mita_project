# MITA –ö–∞–ª–µ–Ω–¥–∞—Ä—å - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏

> –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –±—é–¥–∂–µ—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#1-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö](#2-–ø–æ—Ç–æ–∫-–¥–∞–Ω–Ω—ã—Ö)
3. [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞ –∏–∑ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞](#3-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-–±—é–¥–∂–µ—Ç–∞-–∏–∑-–æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞)
4. [–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞](#4-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è-–¥–æ—Ö–æ–¥–∞)
5. [–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–Ω—è–º](#5-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ-–ø–æ-–¥–Ω—è–º)
6. [–®–∞–±–ª–æ–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π](#6-—à–∞–±–ª–æ–Ω—ã-–ø–æ–≤–µ–¥–µ–Ω–∏—è-–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
7. [–ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞](#7-–ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ-–±—é–¥–∂–µ—Ç–∞)
8. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#8-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
9. [API Endpoints](#9-api-endpoints)
10. [Flutter –∫–ª–∏–µ–Ω—Ç](#10-flutter-–∫–ª–∏–µ–Ω—Ç)
11. [–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞](#11-–ø–æ–ª–Ω—ã–π-–ø—Ä–∏–º–µ—Ä-—Ä–∞—Å—á—ë—Ç–∞)

---

# 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

## 1.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         CALENDAR SYSTEM                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  ONBOARDING  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  BUDGET PLANNER  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ CALENDAR ENGINE‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   (answers)  ‚îÇ     ‚îÇ  (budget_logic)  ‚îÇ     ‚îÇ  (distribution)‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                        ‚îÇ           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ   INCOME     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  COUNTRY PROFILE ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ  ‚îÇ   SERVICE    ‚îÇ     ‚îÇ   (thresholds)   ‚îÇ                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
‚îÇ                                                        ‚îÇ           ‚îÇ
‚îÇ                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚ñº           ‚îÇ
‚îÇ                       ‚îÇ   DAILY PLAN     ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ                       ‚îÇ   (PostgreSQL)   ‚îÇ                        ‚îÇ
‚îÇ                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## 1.2 –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `app/services/core/engine/budget_logic.py` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞ –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ |
| `app/services/core/engine/calendar_engine.py` | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –ø–æ –¥–Ω—è–º |
| `app/services/core/engine/monthly_budget_engine.py` | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ |
| `app/services/core/income_classification_service.py` | –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞ (5 —É—Ä–æ–≤–Ω–µ–π) |
| `app/engine/budget_redistributor.py` | –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–µ |
| `app/services/calendar_service_real.py` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/—á—Ç–µ–Ω–∏–µ –∏–∑ –ë–î |
| `app/api/calendar/routes.py` | API endpoints |
| `app/db/models/daily_plan.py` | –ú–æ–¥–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `app/config/country_profiles_loader.py` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π |

---

# 2. –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

## 2.1 –û—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é

```
–û–ù–ë–û–†–î–ò–ù–ì –ó–ê–í–ï–†–®–Å–ù
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ generate_budget_from_answers(answers)                             ‚îÇ
‚îÇ   —Ñ–∞–π–ª: app/services/core/engine/budget_logic.py                  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ   –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï (answers):                                       ‚îÇ
‚îÇ   {                                                               ‚îÇ
‚îÇ     "region": "US-CA",                                           ‚îÇ
‚îÇ     "income": {"monthly_income": 5000, "additional_income": 500},‚îÇ
‚îÇ     "fixed_expenses": {"rent": 1500, "utilities": 150, ...},     ‚îÇ
‚îÇ     "goals": {"savings_goal_amount_per_month": 500},             ‚îÇ
‚îÇ     "spending_habits": {                                          ‚îÇ
‚îÇ       "coffee_per_week": 3,                                       ‚îÇ
‚îÇ       "dining_out_per_month": 8,                                  ‚îÇ
‚îÇ       "entertainment_per_month": 4,                               ‚îÇ
‚îÇ       "clothing_per_month": 2,                                    ‚îÇ
‚îÇ       "transport_per_month": 200,                                 ‚îÇ
‚îÇ       "travel_per_year": 6                                        ‚îÇ
‚îÇ     }                                                             ‚îÇ
‚îÇ   }                                                               ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ   –í–´–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï (budget_plan):                                  ‚îÇ
‚îÇ   {                                                               ‚îÇ
‚îÇ     "user_class": "middle",                                       ‚îÇ
‚îÇ     "total_income": 5500.00,                                      ‚îÇ
‚îÇ     "fixed_expenses_total": 1850.00,                              ‚îÇ
‚îÇ     "discretionary_total": 3150.00,                               ‚îÇ
‚îÇ     "savings_goal": 500.00,                                       ‚îÇ
‚îÇ     "discretionary_breakdown": {                                  ‚îÇ
‚îÇ       "dining out": 111.25,                                       ‚îÇ
‚îÇ       "entertainment events": 55.75,                              ‚îÇ
‚îÇ       "clothing": 27.72,                                          ‚îÇ
‚îÇ       "travel": 6.93,                                             ‚îÇ
‚îÇ       "coffee": 166.95,                                           ‚îÇ
‚îÇ       "transport": 2780.45                                        ‚îÇ
‚îÇ     }                                                             ‚îÇ
‚îÇ   }                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ build_monthly_budget(user_answers, year, month)                   ‚îÇ
‚îÇ   —Ñ–∞–π–ª: app/services/core/engine/monthly_budget_engine.py         ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ   1. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å fixed_expenses + discretionary_breakdown          ‚îÇ
‚îÇ   2. –°–æ–∑–¥–∞—Ç—å CalendarDay –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞                   ‚îÇ
‚îÇ   3. –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:                                        ‚îÇ
‚îÇ      - –ü–æ–ª—É—á–∏—Ç—å user_frequency –∏–∑ spending_habits                 ‚îÇ
‚îÇ      - –í—ã–∑–≤–∞—Ç—å distribute_budget_over_days()                      ‚îÇ
‚îÇ   4. –í–µ—Ä–Ω—É—Ç—å List[CalendarDay]                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ save_calendar_for_user(db, user_id, calendar)                     ‚îÇ
‚îÇ   —Ñ–∞–π–ª: app/services/calendar_service_real.py                     ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ   –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:                                    ‚îÇ
‚îÇ     INSERT INTO daily_plan (user_id, date, category, planned_amount)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

# 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞ –∏–∑ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞

## 3.1 –ê–ª–≥–æ—Ä–∏—Ç–º (5 —à–∞–≥–æ–≤)

**–§–∞–π–ª:** `app/services/core/engine/budget_logic.py`

```python
def generate_budget_from_answers(answers: dict) -> dict:
```

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```python
region = answers.get("region", "US")  # –†–µ–≥–∏–æ–Ω –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
income_data = answers.get("income", {})
monthly_income = income_data.get("monthly_income", 0)
additional_income = income_data.get("additional_income", 0)
income = monthly_income + additional_income  # –û–±—â–∏–π –¥–æ—Ö–æ–¥
```

### –®–∞–≥ 2: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞

```python
from app.services.core.income_classification_service import classify_income, get_tier_string

income_tier = classify_income(income, region)  # IncomeTier.MIDDLE
user_class = get_tier_string(income_tier)      # "middle"
```

### –®–∞–≥ 3: –†–∞—Å—á—ë—Ç –¥–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞

```python
fixed = answers.get("fixed_expenses", {})
fixed_total = sum(fixed.values())  # –°—É–º–º–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

if fixed_total > income:
    raise ValueError("Fixed expenses exceed income")

discretionary = income - fixed_total  # –ì–∏–±–∫–∏–π –±—é–¥–∂–µ—Ç

# –í—ã—á–∏—Ç–∞–µ–º —Ü–µ–ª—å —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π
savings_goal = answers.get("goals", {}).get("savings_goal_amount_per_month", 0)
discretionary -= savings_goal

if discretionary < 0:
    savings_goal = max(0, savings_goal + discretionary)
    discretionary = 0
```

### –®–∞–≥ 4: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –∏–∑ –ø—Ä–∏–≤—ã—á–µ–∫

```python
freq = answers.get("spending_habits", {})

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ—Ç –≤ –º–µ—Å—è—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
freq_weights = {
    "dining out": freq.get("dining_out_per_month", 0),           # –∫–∞–∫ –µ—Å—Ç—å
    "entertainment events": freq.get("entertainment_per_month", 0),
    "clothing": freq.get("clothing_per_month", 0),
    "travel": freq.get("travel_per_year", 0) / 12,               # –≥–æ–¥ ‚Üí –º–µ—Å—è—Ü
    "coffee": freq.get("coffee_per_week", 0) * 4,                # –Ω–µ–¥–µ–ª—è ‚Üí –º–µ—Å—è—Ü
    "transport": freq.get("transport_per_month", 0),
}

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤
total_freq = sum(freq_weights.values())
if total_freq == 0:
    weights = {k: 1 / len(freq_weights) for k in freq_weights}  # —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
else:
    weights = {k: v / total_freq for k, v in freq_weights.items()}
```

### –®–∞–≥ 5: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞

```python
return {
    "savings_goal": round(savings_goal, 2),
    "user_class": user_class,
    "total_income": round(income, 2),
    "fixed_expenses_total": round(fixed_total, 2),
    "discretionary_total": round(discretionary, 2),
    "discretionary_breakdown": {
        k: round(discretionary * w, 2) for k, w in weights.items()
    },
}
```

## 3.2 –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
monthly_income: $5,000
additional_income: $500
fixed_expenses: $1,850 (rent $1,500 + utilities $150 + insurance $200)
savings_goal: $500

spending_habits:
  coffee_per_week: 3
  dining_out_per_month: 8
  entertainment_per_month: 4
  clothing_per_month: 2
  transport_per_month: 12
  travel_per_year: 6
```

**–†–∞—Å—á—ë—Ç:**
```
total_income = 5000 + 500 = $5,500
fixed_total = $1,850
discretionary = 5500 - 1850 - 500 = $3,150

freq_weights:
  coffee: 3 * 4 = 12
  dining_out: 8
  entertainment: 4
  clothing: 2
  transport: 12
  travel: 6 / 12 = 0.5

total_freq = 12 + 8 + 4 + 2 + 12 + 0.5 = 38.5

weights:
  coffee: 12 / 38.5 = 0.312 (31.2%)
  dining_out: 8 / 38.5 = 0.208 (20.8%)
  entertainment: 4 / 38.5 = 0.104 (10.4%)
  clothing: 2 / 38.5 = 0.052 (5.2%)
  transport: 12 / 38.5 = 0.312 (31.2%)
  travel: 0.5 / 38.5 = 0.013 (1.3%)

discretionary_breakdown:
  coffee: 3150 * 0.312 = $982.80
  dining_out: 3150 * 0.208 = $655.20
  entertainment: 3150 * 0.104 = $327.60
  clothing: 3150 * 0.052 = $163.80
  transport: 3150 * 0.312 = $982.80
  travel: 3150 * 0.013 = $40.95
```

---

# 4. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞

## 4.1 5-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

**–§–∞–π–ª:** `app/services/core/income_classification_service.py`

```python
class IncomeTier(Enum):
    LOW = "low"
    LOWER_MIDDLE = "lower_middle"
    MIDDLE = "middle"
    UPPER_MIDDLE = "upper_middle"
    HIGH = "high"
```

## 4.2 –ü–æ—Ä–æ–≥–∏ (–≥–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥)

| –ö–ª–∞—Å—Å | US (–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) | US-CA (–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è) |
|-------|------------------|-------------------|
| LOW | < $36,000 | < $44,935 |
| LOWER_MIDDLE | $36,001 - $57,600 | $44,936 - $71,896 |
| MIDDLE | $57,601 - $86,400 | $71,897 - $107,844 |
| UPPER_MIDDLE | $86,401 - $144,000 | $107,845 - $179,740 |
| HIGH | > $144,000 | > $179,740 |

**–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è –¥–æ—Ä–æ–∂–µ –Ω–∞ ~25%** - –ø–æ—Ä–æ–≥–∏ –≤—ã—à–µ.

## 4.3 –ê–ª–≥–æ—Ä–∏—Ç–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

```python
def classify_income(monthly_income: float, region: str = "US") -> IncomeTier:
    # –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
    profile = get_profile(region)
    thresholds = profile.get("class_thresholds", {})

    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –≥–æ–¥–æ–≤–æ–π
    annual_income = monthly_income * 12

    if annual_income <= thresholds.get("low", 36000):
        return IncomeTier.LOW
    elif annual_income <= thresholds.get("lower_middle", 57600):
        return IncomeTier.LOWER_MIDDLE
    elif annual_income <= thresholds.get("middle", 86400):
        return IncomeTier.MIDDLE
    elif annual_income <= thresholds.get("upper_middle", 144000):
        return IncomeTier.UPPER_MIDDLE
    else:
        return IncomeTier.HIGH
```

## 4.4 –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å–∞–º

```python
# LOW income
{
    "housing": 0.40,      # 40% –Ω–∞ –∂–∏–ª—å—ë
    "food": 0.15,
    "transport": 0.15,
    "utilities": 0.10,
    "healthcare": 0.08,
    "savings": 0.05,      # 5% —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π
    "entertainment": 0.04,
    "miscellaneous": 0.03
}

# MIDDLE income
{
    "housing": 0.30,      # 30% –Ω–∞ –∂–∏–ª—å—ë (–º–µ–Ω—å—à–µ)
    "food": 0.12,
    "transport": 0.15,
    "utilities": 0.07,
    "healthcare": 0.06,
    "savings": 0.12,      # 12% —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π (–±–æ–ª—å—à–µ)
    "entertainment": 0.08,
    "miscellaneous": 0.10
}

# HIGH income
{
    "housing": 0.25,
    "food": 0.08,
    "transport": 0.10,
    "utilities": 0.04,
    "healthcare": 0.04,
    "savings": 0.12,
    "entertainment": 0.10,
    "investments": 0.20,  # 20% –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
    "luxury": 0.07
}
```

## 4.5 –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ –∫–ª–∞—Å—Å–∞–º

```python
patterns = {
    IncomeTier.LOW: {
        "decision_time": "immediate",           # –†–µ—à–µ–Ω–∏—è —Å—Ä–∞–∑—É
        "planning_horizon": "weekly",           # –ü–ª–∞–Ω–∏—Ä—É—é—Ç –Ω–∞ –Ω–µ–¥–µ–ª—é
        "risk_tolerance": "very_low",
        "mental_accounting_buckets": 2,         # 2 –±–∞–∫–µ—Ç–∞: essential/non-essential
        "savings_rate_target": 0.05,            # 5%
        "housing_ratio_target": 0.40            # –î–æ 40% –Ω–∞ –∂–∏–ª—å—ë
    },
    IncomeTier.MIDDLE: {
        "decision_time": "days_to_weeks",
        "planning_horizon": "quarterly",
        "risk_tolerance": "moderate",
        "mental_accounting_buckets": 6,
        "savings_rate_target": 0.12,
        "housing_ratio_target": 0.30
    },
    IncomeTier.HIGH: {
        "decision_time": "months_to_years",
        "planning_horizon": "multi_year",
        "risk_tolerance": "high",
        "mental_accounting_buckets": 10,
        "savings_rate_target": 0.25,
        "housing_ratio_target": 0.25
    }
}
```

---

# 5. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–Ω—è–º

## 5.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ CalendarDay

**–§–∞–π–ª:** `app/services/core/engine/calendar_engine.py`

```python
class CalendarDay:
    def __init__(self, date: datetime.date):
        self.date: datetime.date = date
        self.day_type: str = "weekend" if date.weekday() >= 5 else "weekday"
        self.planned_budget: Dict[str, float] = {}  # {"food": 50, "transport": 20}
        self.actual_spending: Dict[str, float] = {}
        self.recommendations: List[str] = []
        self.status: str = "green"  # green/yellow/red
        self.total: float = 0.0

    def to_dict(self) -> Dict:
        return {
            "date": self.date.strftime("%Y-%m-%d"),
            "day_type": self.day_type,
            "planned_budget": self.planned_budget,
            "actual_spending": self.actual_spending,
            "recommendations": self.recommendations,
            "status": self.status,
            "total": self.total,
        }
```

## 5.2 –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

**–§–∞–π–ª:** `app/services/core/engine/monthly_budget_engine.py`

```python
def build_monthly_budget(user_answers: dict, year: int, month: int) -> List[Dict]:
    # 1. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
    region = user_answers.get("region", "US-CA")
    profile = COUNTRY_PROFILES.get(region, {})

    # 2. –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ
    income = Decimal(str(user_answers.get("monthly_income", 3000)))
    fixed = user_answers.get("fixed_expenses", {})
    savings_goal = user_answers.get("goals", {}).get("savings_goal_amount_per_month", 0)

    # 3. –†–∞—Å—á—ë—Ç –¥–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞
    fixed_total = sum(Decimal(str(v)) for v in fixed.values())
    discretionary = income - fixed_total - Decimal(str(savings_goal))

    if discretionary < 0:
        raise ValueError("Fixed expenses + goal exceed income")

    # 4. –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–∏–∑ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞)
    discretionary_breakdown = user_answers.get("discretionary_breakdown")

    # 5. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –ø–æ–ª–Ω—ã–π –º–µ—Å—è—á–Ω—ã–π –ø–ª–∞–Ω
    full_month_plan = {}
    full_month_plan.update(fixed)              # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
    full_month_plan.update(discretionary_breakdown)  # –ì–∏–±–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã

    # 6. –ò–∑–≤–ª–µ—á—å —á–∞—Å—Ç–æ—Ç—ã —Ç—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    spending_habits = user_answers.get("spending_habits", {})
    category_frequencies = {
        "coffee": spending_habits.get("coffee_per_week", 0) * 4,
        "transport": spending_habits.get("transport_per_month", 0),
        "dining out": spending_habits.get("dining_out_per_month", 0),
        "entertainment events": spending_habits.get("entertainment_per_month", 0),
        "clothing": spending_habits.get("clothing_per_month", 0),
        "travel": spending_habits.get("travel_per_year", 0) / 12,
    }

    # 7. –°–æ–∑–¥–∞—Ç—å –¥–Ω–∏ –º–µ—Å—è—Ü–∞
    num_days = calendar.monthrange(year, month)[1]
    days = [CalendarDay(datetime.date(year, month, day)) for day in range(1, num_days + 1)]

    # 8. –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∂–¥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    for category, monthly_amount in full_month_plan.items():
        user_frequency = category_frequencies.get(category)
        distribute_budget_over_days(days, category, float(monthly_amount), user_frequency)

    # 9. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å total –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
    for day in days:
        day.total = round(sum(day.planned_budget.values()), 2)

    return [day.to_dict() for day in days]
```

---

# 6. –®–∞–±–ª–æ–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## 6.1 –¢—Ä–∏ —à–∞–±–ª–æ–Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

**–§–∞–π–ª:** `app/services/core/engine/calendar_engine.py`

```python
CATEGORY_BEHAVIOR: Dict[str, str] = {
    # FIXED - –æ–¥–∏–Ω –ø–ª–∞—Ç—ë–∂ –≤ –Ω–∞—á–∞–ª–µ –º–µ—Å—è—Ü–∞
    "rent": "fixed",
    "mortgage": "fixed",
    "utilities": "fixed",
    "subscriptions software": "fixed",
    "media streaming": "fixed",
    "insurance medical": "fixed",
    "gym fitness": "fixed",
    "flights": "fixed",
    "hotels": "fixed",
    "courses online": "fixed",
    "school fees": "fixed",
    "debt repayment": "fixed",
    "investment contribution": "fixed",

    # SPREAD - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ —Ä–∞–±–æ—á–∏–º –¥–Ω—è–º
    "groceries": "spread",
    "transport public": "spread",
    "local transport": "spread",
    "savings emergency": "spread",
    "savings goal based": "spread",

    # CLUSTERED - —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö
    "dining out": "clustered",
    "delivery": "clustered",
    "home repairs": "clustered",
    "transport gas": "clustered",
    "taxi ridehailing": "clustered",
    "car maintenance": "clustered",
    "clothing": "clustered",
    "tech gadgets": "clustered",
    "home goods": "clustered",
    "out of pocket medical": "clustered",
    "entertainment events": "clustered",
    "gaming": "clustered",
    "hobbies": "clustered",
    "books": "clustered",
}
```

## 6.2 –ê–ª–≥–æ—Ä–∏—Ç–º distribute_budget_over_days

```python
def distribute_budget_over_days(
    days: List[CalendarDay],
    category: str,
    total: float,
    user_frequency: int = None  # –ß–∞—Å—Ç–æ—Ç–∞ –∏–∑ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
) -> None:
    behavior = CATEGORY_BEHAVIOR.get(category, "spread")
    num_days = len(days)
```

### –®–∞–±–ª–æ–Ω FIXED

```python
if behavior == "fixed":
    # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–µ–Ω—å –ø–ª–∞—Ç–µ–∂–∞
    if category in ["rent", "mortgage", "school fees"]:
        index = 0  # 1-–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
    else:
        index = min(4, num_days - 1)  # 5-–π –¥–µ–Ω—å –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π

    # –í—Å—è —Å—É–º–º–∞ –≤ –æ–¥–∏–Ω –¥–µ–Ω—å
    days[index].planned_budget[category] = round(total, 2)
```

**–ü—Ä–∏–º–µ—Ä:**
```
rent: $1,500 ‚Üí –î–µ–Ω—å 1: $1,500
utilities: $150 ‚Üí –î–µ–Ω—å 5: $150
```

### –®–∞–±–ª–æ–Ω SPREAD

```python
elif behavior == "spread":
    # –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
    weekday_days = [d for d in days if d.day_type == "weekday"]

    if user_frequency and user_frequency > 0:
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        num_spread_days = min(int(user_frequency), len(weekday_days))
        spread_days = weekday_days[:num_spread_days]
    else:
        # Fallback: –≤—Å–µ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
        spread_days = weekday_days if weekday_days else days

    if len(spread_days) == 0:
        spread_days = days

    # –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å
    per_day = round(total / len(spread_days), 2)
    for day in spread_days:
        day.planned_budget[category] = per_day
```

**–ü—Ä–∏–º–µ—Ä:**
```
coffee: $168/–º–µ—Å—è—Ü, coffee_per_week: 3 ‚Üí 12 –¥–Ω–µ–π
per_day = 168 / 12 = $14
–î–Ω–∏ 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23: $14 –∫–∞–∂–¥—ã–π
```

### –®–∞–±–ª–æ–Ω CLUSTERED

```python
elif behavior == "clustered":
    # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
    if user_frequency and user_frequency > 0:
        num_cluster_days = min(int(user_frequency), num_days)
    else:
        num_cluster_days = 4  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

    # –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω—ã–º
    candidate_days = [d for d in days if d.day_type == "weekend"]

    if len(candidate_days) < num_cluster_days:
        # –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö
        remaining_needed = num_cluster_days - len(candidate_days)
        weekday_candidates = [d for d in days if d.day_type == "weekday"]
        if weekday_candidates:
            candidate_days += random.sample(
                weekday_candidates,
                min(remaining_needed, len(weekday_candidates))
            )

    # –°–ª—É—á–∞–π–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–Ω–∏
    selected_days = random.sample(candidate_days, min(num_cluster_days, len(candidate_days)))

    # –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –¥–Ω—è–º
    chunk = round(total / len(selected_days), 2)
    for day in selected_days:
        day.planned_budget[category] = chunk
```

**–ü—Ä–∏–º–µ—Ä:**
```
entertainment: $200/–º–µ—Å—è—Ü, entertainment_per_month: 4
‚Üí –í—ã–±—Ä–∞—Ç—å 4 –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω—è (—Å—É–±–±–æ—Ç—ã)
‚Üí chunk = 200 / 4 = $50
‚Üí –°—É–±–±–æ—Ç–∞ 1: $50, –°—É–±–±–æ—Ç–∞ 2: $50, –°—É–±–±–æ—Ç–∞ 3: $50, –°—É–±–±–æ—Ç–∞ 4: $50
```

## 6.3 –í–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **user_frequency –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ –¥–µ—Ñ–æ–ª—Ç–æ–≤** - –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª —á–∞—Å—Ç–æ—Ç—É, –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
2. **–í—ã—Ö–æ–¥–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ –¥–ª—è clustered** - —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —à–æ–ø–∏–Ω–≥ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö
3. **–†–∞–±–æ—á–∏–µ –¥–Ω–∏ –¥–ª—è spread** - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ç—Ä–∞—Ç—ã –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
4. **random.sample —Å–æ–∑–¥–∞—ë—Ç –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –Ω–µ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–Ω–∏ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü

---

# 7. –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞

## 7.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–ª –≤ –æ–¥–∏–Ω –¥–µ–Ω—å, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ "—ç–∫–æ–Ω–æ–º–∏—é" –∏–∑ –¥—Ä—É–≥–∏—Ö –¥–Ω–µ–π –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏.

**–§–∞–π–ª:** `app/engine/budget_redistributor.py`

## 7.2 –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

```python
calendar = {
    "1": {"total": 45, "limit": 30},  # –ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥: –ø–æ—Ç—Ä–∞—Ç–∏–ª 45 –ø—Ä–∏ –ª–∏–º–∏—Ç–µ 30
    "2": {"total": 10, "limit": 30},  # –≠–∫–æ–Ω–æ–º–∏—è: –ø–æ—Ç—Ä–∞—Ç–∏–ª 10 –ø—Ä–∏ –ª–∏–º–∏—Ç–µ 30
    "3": {"total": 30, "limit": 30},  # –í –Ω–æ—Ä–º–µ
    ...
}
```

## 7.3 –ê–ª–≥–æ—Ä–∏—Ç–º

```python
class BudgetRedistributor:
    def __init__(self, calendar: Dict[str, Dict]):
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Decimal –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
        self.calendar = {
            day: {
                "total": Decimal(str(data["total"])),
                "limit": Decimal(str(data.get("limit", 0))),
            }
            for day, data in calendar.items()
        }

    def redistribute_budget(self) -> Tuple[Dict, List[Tuple]]:
        # 1. –ù–∞–π—Ç–∏ –¥–Ω–∏ —Å –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–æ–º (–¥–æ–Ω–æ—Ä—ã –¥–µ–Ω–µ–≥ –ù–ï –Ω—É–∂–Ω—ã, –Ω—É–∂–Ω–æ –ø–æ–∫—Ä—ã—Ç—å)
        over_days = [day for day in self.calendar if self._overage(day) > 0]

        # 2. –ù–∞–π—Ç–∏ –¥–Ω–∏ —Å —ç–∫–æ–Ω–æ–º–∏–µ–π (–¥–æ–Ω–æ—Ä—ã - –æ—Ç–∫—É–¥–∞ –≤–æ–∑—å–º—ë–º –¥–µ–Ω—å–≥–∏)
        under_days = [day for day in self.calendar if self._shortfall(day) > 0]

        # 3. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ä–∞–∑–º–µ—Ä—É (–±–æ–ª—å—à–∏–µ –ø–µ—Ä–≤—ã–º–∏)
        over_days.sort(key=self._overage, reverse=True)
        under_days.sort(key=self._shortfall, reverse=True)

        transfers = []

        # 4. –ñ–∞–¥–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ–Ω–æ—Å–∞
        for src in over_days:  # src = –¥–µ–Ω—å —Å –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–æ–º
            src_over = self._overage(src)
            if src_over <= 0:
                continue

            for dst in under_days:  # dst = –¥–µ–Ω—å —Å —ç–∫–æ–Ω–æ–º–∏–µ–π
                dst_need = self._shortfall(dst)
                if dst_need <= 0:
                    continue

                amount = min(src_over, dst_need)
                if amount == 0:
                    continue

                # –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏
                self._apply_transfer(src, dst, amount)
                transfers.append((src, dst, amount))
                src_over -= amount

                if src_over == 0:
                    break

        return self.calendar, transfers

    def _overage(self, day: str) -> Decimal:
        """–ù–∞—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –±–æ–ª—å—à–µ –ª–∏–º–∏—Ç–∞"""
        return self.calendar[day]["total"] - self.calendar[day]["limit"]

    def _shortfall(self, day: str) -> Decimal:
        """–ù–∞—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –º–µ–Ω—å—à–µ –ª–∏–º–∏—Ç–∞ (—ç–∫–æ–Ω–æ–º–∏—è)"""
        return self.calendar[day]["limit"] - self.calendar[day]["total"]

    def _apply_transfer(self, src: str, dst: str, amount: Decimal):
        """–ü–µ—Ä–µ–Ω–æ—Å: —É–º–µ–Ω—å—à–∏—Ç—å total —É src, —É–≤–µ–ª–∏—á–∏—Ç—å —É dst"""
        self.calendar[src]["total"] -= amount
        self.calendar[dst]["total"] += amount
```

## 7.4 –ü—Ä–∏–º–µ—Ä

```
–î–û:
–î–µ–Ω—å 1: total=45, limit=30 (–ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ 15)
–î–µ–Ω—å 2: total=10, limit=30 (—ç–∫–æ–Ω–æ–º–∏—è 20)
–î–µ–Ω—å 3: total=25, limit=30 (—ç–∫–æ–Ω–æ–º–∏—è 5)

–ê–õ–ì–û–†–ò–¢–ú:
- over_days = [1] (–ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ 15)
- under_days = [2, 3] (—ç–∫–æ–Ω–æ–º–∏—è 20, 5)

–ü–µ—Ä–µ–Ω–æ—Å 1: –î–µ–Ω—å 1 ‚Üí –î–µ–Ω—å 2, amount = min(15, 20) = 15
  –î–µ–Ω—å 1: total = 45 - 15 = 30 ‚úì
  –î–µ–Ω—å 2: total = 10 + 15 = 25

–ü–û–°–õ–ï:
–î–µ–Ω—å 1: total=30, limit=30 (–Ω–æ—Ä–º–∞)
–î–µ–Ω—å 2: total=25, limit=30 (—ç–∫–æ–Ω–æ–º–∏—è 5)
–î–µ–Ω—å 3: total=25, limit=30 (—ç–∫–æ–Ω–æ–º–∏—è 5)

–¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã: [(1, 2, 15)]
```

---

# 8. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## 8.1 –ú–æ–¥–µ–ª—å DailyPlan

**–§–∞–π–ª:** `app/db/models/daily_plan.py`

```python
class DailyPlan(Base):
    __tablename__ = "daily_plan"

    id = Column(UUID, primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID, nullable=False, index=True)
    date = Column(DateTime(timezone=True), nullable=False, index=True)

    category = Column(String(100), nullable=True, index=True)
    planned_amount = Column(Numeric(12, 2), default=Decimal("0.00"))
    spent_amount = Column(Numeric(12, 2), default=Decimal("0.00"))
    daily_budget = Column(Numeric(12, 2), nullable=True)
    status = Column(String(20), default="green")  # green/yellow/red

    plan_json = Column(JSONB, nullable=True)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    created_at = Column(DateTime(timezone=True), default=datetime.utcnow)
```

## 8.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å–µ–π

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è —Å–æ–∑–¥–∞—ë—Ç—Å—è **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π** - –ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:

```
user_id | date       | category      | planned_amount | spent_amount | status
--------|------------|---------------|----------------|--------------|-------
abc123  | 2025-02-01 | rent          | 1500.00        | 1500.00      | green
abc123  | 2025-02-01 | utilities     | 150.00         | 0.00         | green
abc123  | 2025-02-02 | coffee        | 14.00          | 12.50        | green
abc123  | 2025-02-02 | transport     | 8.00           | 8.00         | green
abc123  | 2025-02-03 | dining out    | 50.00          | 65.00        | red
...
```

## 8.3 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è

**–§–∞–π–ª:** `app/services/calendar_service_real.py`

```python
def save_calendar_for_user(db: Session, user_id: UUID, calendar: List[Dict]):
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å List —Ñ–æ—Ä–º–∞—Ç –≤ Dict
    calendar_dict = {}
    for day_entry in calendar:
        date_str = day_entry.get("date")
        planned_budget = day_entry.get("planned_budget", {})
        if date_str and planned_budget:
            calendar_dict[date_str] = planned_budget

    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∂–¥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
    for day_str, categories in calendar_dict.items():
        day_date = date.fromisoformat(day_str)
        for category, amount in categories.items():
            db_plan = DailyPlan(
                id=uuid.uuid4(),
                user_id=user_id,
                date=day_date,
                category=category,
                planned_amount=Decimal(amount),
                spent_amount=Decimal("0.00"),
            )
            db.add(db_plan)

    db.commit()
```

## 8.4 –ß—Ç–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è

```python
def fetch_calendar(db: Session, user_id: UUID, year: int, month: int) -> Dict:
    results = db.query(DailyPlan).filter(
        DailyPlan.user_id == user_id,
        DailyPlan.date >= date(year, month, 1),
        DailyPlan.date < date(year + (month // 12), ((month % 12) + 1), 1)
    ).all()

    calendar = {}
    for plan in results:
        key = plan.date.isoformat()
        if key not in calendar:
            calendar[key] = {}
        calendar[key][plan.category] = float(plan.planned_amount)

    return calendar
```

---

# 9. API Endpoints

## 9.1 –°–ø–∏—Å–æ–∫ endpoints

**–§–∞–π–ª:** `app/api/calendar/routes.py`

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/calendar/generate` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è |
| GET | `/calendar/day/{year}/{month}/{day}` | –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –¥–µ–Ω—å |
| PATCH | `/calendar/day/{year}/{month}/{day}` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å |
| POST | `/calendar/day_state` | –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–Ω—è |
| POST | `/calendar/redistribute` | –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –±—é–¥–∂–µ—Ç |
| POST | `/calendar/shell` | –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–µ–≤—å—é –∫–∞–ª–µ–Ω–¥–∞—Ä—è |
| GET | `/calendar/current-month` | –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü |
| GET | `/calendar/saved/{year}/{month}` | –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å |

## 9.2 GET /calendar/saved/{year}/{month}

**–û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –º–æ–±–∏–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.**

```python
@router.get("/saved/{year}/{month}")
async def get_saved_calendar(year: int, month: int, user=Depends(get_current_user)):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏–∑ –ë–î"""

    rows = db.query(DailyPlan).filter(
        DailyPlan.user_id == user.id,
        extract('year', DailyPlan.date) == year,
        extract('month', DailyPlan.date) == month,
    ).order_by(DailyPlan.date).all()

    # –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–Ω—è–º
    days_data = defaultdict(lambda: {
        'date': None,
        'day': 0,
        'total_budget': 0,
        'total_planned': 0,
        'total_spent': 0,
        'categories': {}
    })

    for row in rows:
        day_key = row.date.isoformat()
        day_data = days_data[day_key]

        if day_data['date'] is None:
            day_data['date'] = row.date.isoformat()
            day_data['day'] = row.date.day

        day_data['total_planned'] += (row.planned_amount or 0)
        day_data['total_spent'] += (row.spent_amount or 0)

        day_data['categories'][row.category] = {
            'planned': float(row.planned_amount or 0),
            'spent': float(row.spent_amount or 0),
            'status': row.status or 'pending'
        }

    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–ø–∏—Å–æ–∫
    calendar_days = []
    for day_data in days_data.values():
        calendar_days.append({
            'date': day_data['date'],
            'day': day_data['day'],
            'planned_budget': day_data['categories'],
            'limit': float(day_data['total_budget']),
            'total': float(day_data['total_planned']),
            'spent': float(day_data['total_spent']),
            'status': 'active' if day_data['total_spent'] > 0 else 'pending'
        })

    calendar_days.sort(key=lambda x: x['date'])

    return {"data": {"calendar": calendar_days}}
```

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "data": {
    "calendar": [
      {
        "date": "2025-02-01",
        "day": 1,
        "planned_budget": {
          "rent": {"planned": 1500, "spent": 1500, "status": "green"},
          "utilities": {"planned": 150, "spent": 0, "status": "pending"}
        },
        "limit": 1650,
        "total": 1650,
        "spent": 1500,
        "status": "active"
      },
      {
        "date": "2025-02-02",
        "day": 2,
        "planned_budget": {
          "coffee": {"planned": 14, "spent": 12.5, "status": "green"},
          "transport": {"planned": 8, "spent": 8, "status": "green"}
        },
        "limit": 22,
        "total": 22,
        "spent": 20.5,
        "status": "active"
      }
    ]
  }
}
```

## 9.3 POST /calendar/redistribute

```python
@router.post("/redistribute")
async def redistribute(payload: RedistributeInput):
    """
    –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –±—é–¥–∂–µ—Ç –º–µ–∂–¥—É –¥–Ω—è–º–∏.

    Request:
    {
      "calendar": {
        "1": {"total": 45, "limit": 30},
        "2": {"total": 10, "limit": 30}
      },
      "strategy": "balance"
    }

    Response:
    {
      "data": {
        "updated_calendar": {
          "1": {"total": 30, "limit": 30},
          "2": {"total": 25, "limit": 30}
        }
      }
    }
    """
    updated_calendar = redistribute_calendar_budget(payload.calendar)
    return {"data": {"updated_calendar": updated_calendar}}
```

## 9.4 Schemas

**–§–∞–π–ª:** `app/api/calendar/schemas.py`

```python
class GenerateCalendarRequest(BaseModel):
    calendar_id: str
    start_date: date
    num_days: int
    budget_plan: Dict[str, float]

class ShellConfig(BaseModel):
    savings_target: float
    income: float
    fixed: Dict[str, float]
    weights: Dict[str, float]
    year: int
    month: int

class RedistributeInput(BaseModel):
    calendar: dict
    strategy: str = "balance"
```

---

# 10. Flutter –∫–ª–∏–µ–Ω—Ç

## 10.1 BudgetProvider

**–§–∞–π–ª:** `mobile_app/lib/providers/budget_provider.dart`

```dart
class BudgetProvider extends ChangeNotifier {
  List<dynamic> _calendarData = [];

  List<dynamic> get calendarData => _calendarData;

  /// –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
  Future<void> loadCalendarData({int? year, int? month}) async {
    final now = DateTime.now();
    final targetYear = year ?? now.year;
    final targetMonth = month ?? now.month;

    try {
      // 1. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å production budget engine
      final productionData = await _budgetService.getCalendarData();
      _calendarData = productionData;
    } catch (e) {
      try {
        // 2. Fallback: behavioral calendar
        final behavioralCalendar = await _apiService.getBehaviorCalendar(
          year: targetYear,
          month: targetMonth,
        );
        _calendarData = _convertBehavioralCalendarData(behavioralCalendar);
      } catch (e) {
        // 3. Fallback: standard API
        final data = await _apiService.getCalendar();
        _calendarData = data;
      }
    }
    notifyListeners();
  }
}
```

## 10.2 CalendarScreen

**–§–∞–π–ª:** `mobile_app/lib/screens/calendar_screen.dart`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Ä–∞–Ω–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  AppBar: "Calendar - February 2025"     ‚îÇ
‚îÇ  [Settings] [Refresh]                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Month Overview Card                    ‚îÇ
‚îÇ  Total Budget: $5,500                   ‚îÇ
‚îÇ  Spent: $2,150 | Remaining: $3,350      ‚îÇ
‚îÇ  [====== 39% =======              ]     ‚îÇ
‚îÇ  On Track: 15 | Warning: 3 | Over: 2    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Daily Spending Status (Legend)         ‚îÇ
‚îÇ  üü¢ On Track  üü° Warning  üî¥ Over       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Calendar Grid                          ‚îÇ
‚îÇ   S   M   T   W   T   F   S             ‚îÇ
‚îÇ  [ ] [üü¢] [üü¢] [üü¢] [üü°] [üü¢] [üü¢]      ‚îÇ
‚îÇ  [üü¢] [üü¢] [üü¢] [üî¥] [üü¢] [üü¢] [üü¢]      ‚îÇ
‚îÇ  [üü¢] ...                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  FAB: [+ Add Expense]                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## 10.3 –¶–≤–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–Ω—è

```dart
Color _getSimpleDayColor(String status, bool isToday) {
  if (isToday) {
    switch (status.toLowerCase()) {
      case 'over':
        return Colors.red.shade100;
      case 'warning':
        return Colors.orange.shade100;
      default:
        return Colors.blue.shade100;
    }
  }

  switch (status.toLowerCase()) {
    case 'over':
      return Colors.red.shade50;
    case 'warning':
      return Colors.orange.shade50;
    default:
      return Colors.green.shade50;
  }
}
```

## 10.4 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

```dart
// –í –±—ç–∫–µ–Ω–¥–µ –∏–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:
String getStatus(double spent, double limit) {
  if (limit == 0) return 'neutral';

  double ratio = spent / limit;

  if (ratio > 1.0) return 'over';      // –ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥
  if (ratio >= 0.8) return 'warning';  // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (80%+)
  if (ratio > 0) return 'good';        // –í –Ω–æ—Ä–º–µ
  return 'neutral';                     // –ù–µ—Ç —Ç—Ä–∞—Ç
}
```

---

# 11. –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–∑ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞)

```json
{
  "region": "US-CA",
  "income": {
    "monthly_income": 6000,
    "additional_income": 0
  },
  "fixed_expenses": {
    "rent": 1800,
    "utilities": 200,
    "insurance": 150,
    "subscriptions": 50
  },
  "goals": {
    "savings_goal_amount_per_month": 600
  },
  "spending_habits": {
    "coffee_per_week": 4,
    "dining_out_per_month": 8,
    "entertainment_per_month": 4,
    "clothing_per_month": 2,
    "transport_per_month": 15,
    "travel_per_year": 3
  }
}
```

## –®–∞–≥ 1: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞

```
–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥: $6,000 √ó 12 = $72,000
–†–µ–≥–∏–æ–Ω: US-CA
–ü–æ—Ä–æ–≥–∏ CA: low=44935, lower_middle=71896, middle=107844

$72,000 > $71,896 ‚Üí MIDDLE –∫–ª–∞—Å—Å (Strategic Achiever)
```

## –®–∞–≥ 2: –†–∞—Å—á—ë—Ç –±—é–¥–∂–µ—Ç–∞

```
–í—Å–µ–≥–æ –¥–æ—Ö–æ–¥: $6,000
–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ: $1,800 + $200 + $150 + $50 = $2,200
–°–±–µ—Ä–µ–∂–µ–Ω–∏—è: $600
–î–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω—ã–π: $6,000 - $2,200 - $600 = $3,200
```

## –®–∞–≥ 3: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤

```
freq_weights:
  coffee: 4 * 4 = 16
  dining_out: 8
  entertainment: 4
  clothing: 2
  transport: 15
  travel: 3 / 12 = 0.25

total_freq = 16 + 8 + 4 + 2 + 15 + 0.25 = 45.25

weights:
  coffee: 16 / 45.25 = 0.354 (35.4%)
  dining_out: 8 / 45.25 = 0.177 (17.7%)
  entertainment: 4 / 45.25 = 0.088 (8.8%)
  clothing: 2 / 45.25 = 0.044 (4.4%)
  transport: 15 / 45.25 = 0.332 (33.2%)
  travel: 0.25 / 45.25 = 0.006 (0.6%)
```

## –®–∞–≥ 4: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω–æ–≥–æ

```
discretionary_breakdown:
  coffee: $3,200 √ó 0.354 = $1,132.80
  dining_out: $3,200 √ó 0.177 = $566.40
  entertainment: $3,200 √ó 0.088 = $281.60
  clothing: $3,200 √ó 0.044 = $140.80
  transport: $3,200 √ó 0.332 = $1,062.40
  travel: $3,200 √ó 0.006 = $19.20
```

## –®–∞–≥ 5: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–Ω—è–º (–§–µ–≤—Ä–∞–ª—å 2025, 28 –¥–Ω–µ–π)

### –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (FIXED pattern):
```
–î–µ–Ω—å 1:
  rent: $1,800
  utilities: $200 (–Ω–∞ 5-–π –¥–µ–Ω—å)
  insurance: $150
  subscriptions: $50

–î–µ–Ω—å 5:
  utilities: $200
```

### Coffee (SPREAD pattern, 16 –¥–Ω–µ–π):
```
$1,132.80 / 16 = $70.80 –Ω–∞ –¥–µ–Ω—å
–î–Ω–∏: 1, 2, 3, 4, 5, 7, 8, 10, 11, 12, 14, 15, 17, 18, 21, 24
(–ø–µ—Ä–≤—ã–µ 16 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)
```

### Dining out (CLUSTERED pattern, 8 –¥–Ω–µ–π):
```
$566.40 / 8 = $70.80 –Ω–∞ –¥–µ–Ω—å
–î–Ω–∏: –≤—ã—Ö–æ–¥–Ω—ã–µ + –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—É–¥–Ω–µ–π
–°–± 1, –í—Å 2, –°–± 8, –í—Å 9, –°–± 15, –í—Å 16, –°–± 22, –í—Å 23
```

### Entertainment (CLUSTERED pattern, 4 –¥–Ω—è):
```
$281.60 / 4 = $70.40 –Ω–∞ –¥–µ–Ω—å
–î–Ω–∏: 4 —Å—É–±–±–æ—Ç—ã
–°–± 1, –°–± 8, –°–± 15, –°–± 22
```

### Clothing (CLUSTERED pattern, 2 –¥–Ω—è):
```
$140.80 / 2 = $70.40 –Ω–∞ –¥–µ–Ω—å
–î–Ω–∏: 2 –≤—ã—Ö–æ–¥–Ω—ã—Ö
–°–± 8, –°–± 22
```

### Transport (SPREAD pattern, 15 –¥–Ω–µ–π):
```
$1,062.40 / 15 = $70.83 –Ω–∞ –¥–µ–Ω—å
–î–Ω–∏: 15 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
```

### Travel (CLUSTERED pattern, ~0.25 = 1 –¥–µ–Ω—å):
```
$19.20 / 1 = $19.20
–î–µ–Ω—å: –°–± 15 (–æ–¥–∏–Ω –¥–µ–Ω—å)
```

## –ò—Ç–æ–≥–æ–≤—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):

```
–î–µ–Ω—å 1 (–°–±):  $1,800 (rent) + $150 (ins) + $50 (subs) + $70.80 (coffee) + $70.80 (dining) + $70.40 (ent) = $2,212
–î–µ–Ω—å 2 (–í—Å):  $70.80 (dining) = $70.80
–î–µ–Ω—å 3 (–ü–Ω):  $70.80 (coffee) + $70.83 (transport) = $141.63
–î–µ–Ω—å 4 (–í—Ç):  $70.80 (coffee) + $70.83 (transport) = $141.63
–î–µ–Ω—å 5 (–°—Ä):  $200 (utilities) + $70.80 (coffee) + $70.83 (transport) = $341.63
...
–î–µ–Ω—å 8 (–°–±):  $70.80 (dining) + $70.40 (ent) + $70.40 (clothing) = $211.60
...
–î–µ–Ω—å 15 (–°–±): $70.80 (dining) + $70.40 (ent) + $19.20 (travel) = $160.40
...
–î–µ–Ω—å 22 (–°–±): $70.80 (dining) + $70.40 (ent) + $70.40 (clothing) = $211.60
...
```

---

# –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É "—É–º–Ω–æ–π":

1. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥** - —á–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–∞—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
2. **–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è** - CA –¥–æ—Ä–æ–∂–µ TX, –ø–æ—Ä–æ–≥–∏ —Ä–∞–∑–Ω—ã–µ
3. **5 –∫–ª–∞—Å—Å–æ–≤ –¥–æ—Ö–æ–¥–∞** - —Ä–∞–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
4. **3 —à–∞–±–ª–æ–Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** - fixed/spread/clustered
5. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö** - —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —à–æ–ø–∏–Ω–≥ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö
6. **–ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –∏–∑ —ç–∫–æ–Ω–æ–º–∏–∏

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –ù–ï —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:

1. **coffee_per_week: 4** ‚Üí 16 –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü, –Ω–µ 30
2. **dining_out_per_month: 8** ‚Üí 8 –¥–Ω–µ–π –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö
3. **rent** ‚Üí 1 –¥–µ–Ω—å (1-–µ —á–∏—Å–ª–æ)
4. **–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫ –æ–¥–µ–∂–¥—ã 2 –¥–Ω—è –ø–æ–¥—Ä—è–¥** - clustered —Å random –≤—ã–±–æ—Ä–æ–º

## –î–∞–Ω–Ω—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã:

1. `monthly_income` - –º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥
2. `region` - —Ä–µ–≥–∏–æ–Ω –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. `fixed_expenses` - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
4. `savings_goal_amount_per_month` - —Ü–µ–ª—å —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π
5. `spending_habits` - —á–∞—Å—Ç–æ—Ç—ã —Ç—Ä–∞—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –ª–æ–≥–∏–∫–∏ MITA Calendar –≤ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç.*
