# –ú–û–î–£–õ–¨ 3: –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (Main Screen Module)

## üì± –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ - —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ MITA –ø–æ—Å–ª–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –æ–±–∑–æ—Ä –µ–≥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å, –¥–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏ –ø–æ –±—é–¥–∂–µ—Ç—É, –Ω–µ–¥–∞–≤–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ AI-–∏–Ω—Å–∞–π—Ç—ã.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. **Dashboard Overview**
- **–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–î–Ω–µ–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã**: –°—É–º–º–∞ –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–∞—è —Å–µ–≥–æ–¥–Ω—è
- **–û—Å—Ç–∞–≤—à–∏–π—Å—è –±—é–¥–∂–µ—Ç**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–∞

### 2. **Budget Targets (–î–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏)**
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±—é–¥–∂–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:
  - üçî Food & Dining
  - üöó Transportation
  - üé¨ Entertainment
  - üõçÔ∏è Shopping
  - üè• Healthcare
  - ‚ö° Utilities
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –¶–≤–µ—Ç–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∑–µ–ª–µ–Ω—ã–π/–∂–µ–ª—Ç—ã–π/–∫—Ä–∞—Å–Ω—ã–π)
- –ò–∫–æ–Ω–∫–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 3. **Weekly Overview (–ù–µ–¥–µ–ª—å–Ω—ã–π –æ–±–∑–æ—Ä)**
- –ú–∏–Ω–∏-–∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 7 –¥–Ω–µ–π
- –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è:
  - ‚úÖ Good (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –±—é–¥–∂–µ—Ç–∞)
  - ‚ö†Ô∏è Warning (–ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –ª–∏–º–∏—Ç—É)
  - ‚ùå Over (–ø—Ä–µ–≤—ã—à–µ–Ω –±—é–¥–∂–µ—Ç)

### 4. **Recent Transactions**
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
  - –°—É–º–º–∞
  - –ö–∞—Ç–µ–≥–æ—Ä–∏—è
  - –û–ø–∏—Å–∞–Ω–∏–µ
  - –í—Ä–µ–º—è (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ: "2h ago", "1d ago")
  - –ò–∫–æ–Ω–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### 5. **AI Insights Preview**
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã
- –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### 6. **Quick Actions**
- –ö–Ω–æ–ø–∫–∞ "Add Expense" (FloatingActionButton)
- –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ –¥—Ä—É–≥–∏–º —ç–∫—Ä–∞–Ω–∞–º
- Refresh –¥–∞–Ω–Ω—ã—Ö (pull-to-refresh)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend Components

#### 1. **Dashboard API** (`/api/dashboard`)

**Endpoint**: `GET /api/dashboard`

**–û—Ç–≤–µ—Ç**:
```json
{
  "status": "success",
  "data": {
    "balance": 2500.00,
    "spent": 45.50,
    "daily_targets": [
      {
        "category": "Food & Dining",
        "limit": 100.00,
        "spent": 25.50,
        "icon": "restaurant",
        "color": "#4CAF50"
      }
    ],
    "week": [
      {
        "day": "Mon",
        "status": "good",
        "spent": 75.00,
        "budget": 100.00
      }
    ],
    "transactions": [
      {
        "id": "uuid",
        "amount": 25.50,
        "category": "food",
        "action": "Lunch at Cafe",
        "date": "2025-10-22T12:30:00Z",
        "icon": "restaurant",
        "color": "#4CAF50"
      }
    ],
    "insights_preview": {
      "text": "Great job! Only 45% of budget used.",
      "title": "Excellent"
    },
    "user_income": 3000.00
  }
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Ö–æ–¥–∞ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –∏–∑ `DailyPlan` —Ç–∞–±–ª–∏—Ü—ã
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤

#### 2. **Quick Stats API** (`/api/dashboard/quick-stats`)

**Endpoint**: `GET /api/dashboard/quick-stats`

**–û—Ç–≤–µ—Ç**:
```json
{
  "status": "success",
  "data": {
    "monthly_spending": 1500.00,
    "daily_average": 68.18,
    "top_category": {
      "name": "Food",
      "amount": 450.00
    },
    "savings_rate": 50.0,
    "savings_amount": 1500.00
  }
}
```

### Frontend Components

#### 1. **Main Screen** (`lib/screens/main_screen.dart`)

**State Management**:
```dart
class _MainScreenState extends State<MainScreen> {
  Map<String, dynamic>? dashboardData;
  Map<String, dynamic>? latestAdvice;
  Map<String, dynamic>? userProfile;

  bool isLoading = false;
  String? error;

  IncomeTier? _incomeTier;
  double _monthlyIncome = 0.0;

  final OfflineFirstProvider _offlineProvider;
  final LiveUpdatesService _liveUpdates;
  final BudgetAdapterService _budgetService;
}
```

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:

- `_initializeOfflineFirst()`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è offline-first loading
- `_loadProductionBudgetData()`: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å production budget engine
- `refreshData()`: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `_buildBalanceCard()`: –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –±–∞–ª–∞–Ω—Å–∞
- `_buildBudgetTargets()`: –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–Ω–µ–≤–Ω—ã—Ö —Ü–µ–ª–µ–π
- `_buildMiniCalendar()`: –ù–µ–¥–µ–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
- `_buildRecentTransactions()`: –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

#### 2. **API Service** (`lib/services/api_service.dart`)

**Dashboard Method**:
```dart
Future<Map<String, dynamic>> getDashboard({double? userIncome}) async {
  // 1. Try new dedicated /api/dashboard endpoint
  // 2. Fallback to legacy calendar/shell approach
  // 3. Transform data to expected format
}
```

**Features**:
- Automatic fallback to legacy endpoints
- Secure token storage
- Comprehensive error handling
- Timeout management

#### 3. **Budget Adapter Service** (`lib/services/budget_adapter_service.dart`)

–ê–¥–∞–ø—Ç–µ—Ä –º–µ–∂–¥—É production budget engine –∏ UI:
```dart
class BudgetAdapterService {
  Future<Map<String, dynamic>> getDashboardData();
  Future<List<Map<String, dynamic>>> getCalendarData();
  Future<Map<String, dynamic>> getBudgetInsights();
}
```

#### 4. **Offline First Provider** (`lib/services/offline_first_provider.dart`)

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ offline —Ä–µ–∂–∏–º–µ:
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ dashboard –¥–∞–Ω–Ω—ã—Ö
- –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- Instant UI —Å cached –¥–∞–Ω–Ω—ã–º–∏

#### 5. **Live Updates Service** (`lib/services/live_updates_service.dart`)

Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
- Periodic polling (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)
- Stream-based data updates
- Automatic refresh –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö

## üé® UI/UX Features

### 1. **Loading States**
- ‚úÖ Instant UI —Å cached –¥–∞–Ω–Ω—ã–º–∏
- ‚è≥ Subtle loading indicators
- üîÑ Pull-to-refresh
- ‚ö° Background sync –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI

### 2. **Error Handling**
- üî¥ Network error state
- üìù Incomplete profile state
- ‚ö†Ô∏è Fallback data –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- üîÅ Retry mechanisms

### 3. **Empty States**
- üìä "No transactions" message
- üí° Guidance –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üéØ Call-to-action –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### 4. **Responsive Design**
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–æ–≤
- üé® –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
- ‚ôø Accessibility support

### 5. **Animations**
- ‚ú® Smooth transitions –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- üìà Animated progress bars
- üí´ Subtle micro-interactions

## üîÑ Data Flow

```mermaid
graph TD
    A[Main Screen Init] --> B[Load Cached Data]
    B --> C[Display Instant UI]
    C --> D[Fetch from API]
    D --> E{API Success?}
    E -->|Yes| F[Update UI with Fresh Data]
    E -->|No| G[Show Cached Data + Warning]
    F --> H[Cache New Data]
    G --> H
    H --> I[Setup Live Updates]
    I --> J[Periodic Refresh Every 2min]
    J --> D
```

## üìä Performance Optimizations

### 1. **Offline-First Architecture**
- Instant UI rendering —Å cached –¥–∞–Ω–Ω—ã–º–∏
- –ù–µ—Ç blocking network calls –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- Background sync –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ UX

### 2. **Efficient Data Loading**
- Single comprehensive endpoint (`/api/dashboard`)
- Reduced number of API calls
- Optimized SQL queries –≤ backend

### 3. **Smart Caching**
- Multi-level caching strategy
- Automatic cache invalidation
- Compressed data storage

### 4. **Lazy Loading**
- IndexedStack –¥–ª—è tab navigation
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ state –º–µ–∂–¥—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è–º–∏
- Efficient memory management

## üß™ Testing

### Unit Tests
```dart
// lib/services/__tests__/api_service_test.dart
test('getDashboard returns valid data', () async {
  final service = ApiService();
  final data = await service.getDashboard();

  expect(data['balance'], isNotNull);
  expect(data['spent'], isNotNull);
  expect(data['daily_targets'], isA<List>());
});
```

### Widget Tests
```dart
// lib/screens/__tests__/main_screen_test.dart
testWidgets('Main Screen displays dashboard data', (tester) async {
  await tester.pumpWidget(MainScreen());

  expect(find.text('Current Balance'), findsOneWidget);
  expect(find.byType(FloatingActionButton), findsOneWidget);
});
```

### Integration Tests
```dart
// integration_test/main_screen_flow_test.dart
testWidgets('Complete main screen user flow', (tester) async {
  // 1. Login
  // 2. Navigate to main screen
  // 3. Verify dashboard loads
  // 4. Add expense via FAB
  // 5. Verify dashboard updates
});
```

## üîí Security Considerations

### 1. **Authentication**
- JWT tokens –¥–ª—è –≤—Å–µ—Ö API calls
- Automatic token refresh
- Secure token storage

### 2. **Data Privacy**
- Encrypted local storage
- No sensitive data in logs
- GDPR compliant data handling

### 3. **Input Validation**
- Server-side validation
- SQL injection prevention
- XSS protection

## üìà Analytics & Monitoring

### Tracked Events
- `main_screen_view` - Screen view count
- `dashboard_load_time` - Performance metric
- `dashboard_error` - Error tracking
- `budget_target_click` - User engagement
- `add_expense_fab_click` - Action tracking

### Performance Metrics
- API response time: Target < 200ms
- Screen load time: Target < 1s with cached data
- Memory usage: Target < 100MB
- Crash rate: Target < 0.1%

## üöÄ Future Enhancements

### Planned Features
- [ ] Widgets –¥–ª—è home screen
- [ ] Swipe actions –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- [ ] Customizable dashboard layout
- [ ] Advanced filtering
- [ ] Export dashboard data
- [ ] Dark mode optimizations
- [ ] Voice commands –¥–ª—è quick actions
- [ ] AI-powered spending predictions
- [ ] Social sharing features
- [ ] Gamification elements

### Performance Improvements
- [ ] GraphQL migration –¥–ª—è efficient data fetching
- [ ] WebSocket –¥–ª—è real-time updates
- [ ] Image lazy loading
- [ ] Incremental data loading
- [ ] Advanced caching strategies

## üìù Development Guidelines

### Adding New Dashboard Widgets

1. **Backend**: Add data to dashboard endpoint
```python
# app/api/dashboard/routes.py
@router.get("")
async def get_dashboard():
    return success_response({
        # ... existing data
        'new_widget_data': compute_widget_data()
    })
```

2. **Frontend**: Create widget component
```dart
// lib/widgets/new_widget.dart
Widget _buildNewWidget() {
  final data = dashboardData?['new_widget_data'];
  return Card(/* ... */);
}
```

3. **Integration**: Add to main screen
```dart
// lib/screens/main_screen.dart
Column(
  children: [
    // ... existing widgets
    _buildNewWidget(),
  ],
)
```

### Customizing Budget Categories

Edit category configuration:
```dart
// lib/services/budget_adapter_service.dart
final category_icons = {
  'new_category': Icons.new_icon,
};

final category_colors = {
  'new_category': Color(0xFFHEXCODE),
};
```

## üêõ Troubleshooting

### Common Issues

**1. Dashboard not loading**
- Check authentication token
- Verify backend is running
- Check network connectivity
- Review logs for errors

**2. Data not refreshing**
- Check Live Updates Service
- Verify pull-to-refresh works
- Check cache invalidation

**3. Incorrect balance calculation**
- Verify user income is set
- Check transaction data integrity
- Review budget calculation logic

## üìö Related Documentation

- [API Documentation](API_DOCUMENTATION.md)
- [Budget Engine Documentation](BUDGET_ENGINE.md)
- [Authentication Flow](AUTHENTICATION.md)
- [Offline-First Architecture](OFFLINE_FIRST.md)
- [Testing Guidelines](TESTING.md)

## üë• Contributors

- **Backend**: Dashboard API, Budget calculations
- **Frontend**: Main Screen UI, Data integration
- **UX**: Design system, Animations
- **QA**: Testing, Performance optimization

## üìÑ License

Proprietary - YAKOVLEV LTD ¬© 2025

---

**Last Updated**: January 2025
**Version**: 1.0.0
**Status**: ‚úÖ Production Ready
